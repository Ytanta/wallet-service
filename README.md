# Wallet Service

Приложение для управления балансом кошельков с поддержкой операций пополнения и снятия средств через REST API.

---

## Функционал

- Приём POST-запросов для операций над кошельком:
  - **DEPOSIT** — пополнение баланса
  - **WITHDRAW** — списание средств (с проверкой достаточности баланса)
- Получение текущего баланса кошелька через GET-запрос
- Обработка ошибок:
  - Некорректный запрос (валидируется JSON и параметры)
  - Несуществующий кошелёк
  - Недостаточно средств для снятия
- Высокая конкурентная нагрузка:  
  Используется оптимистичная блокировка и retry-механизм для корректного обновления баланса при 1000+ запросов в секунду
- Хранение данных в PostgreSQL с миграциями через Liquibase
- Запуск приложения и базы через Docker и Docker Compose
- Конфигурация приложения и базы через переменные окружения без пересборки контейнеров
- Покрытие тестами бизнес-логики и REST-контроллеров

---

## Технологии

- Java 17
- Spring Boot 3
- Hibernate / JPA
- PostgreSQL 15
- Liquibase
- Docker, Docker Compose
- JUnit 5, Mockito для тестирования
- Lombok

---

## Запуск проекта

1. Клонировать репозиторий

git clone <URL_репозитория>
cd wallet-service
Построить проект и собрать jar


./gradlew clean build
Запустить контейнеры


docker-compose up --build
Приложение будет доступно по адресу: http://localhost:8080

Примеры запросов
Пополнение баланса

POST /api/v1/wallet
Content-Type: application/json

{
  "walletId": "uuid-кошелька",
  "operationType": "DEPOSIT",
  "amount": 1000
}
Снятие средств

POST /api/v1/wallet
Content-Type: application/json

{
  "walletId": "uuid-кошелька",
  "operationType": "WITHDRAW",
  "amount": 500
}
Получение баланса

GET /api/v1/wallets/{walletId}
Конфигурация
Все параметры подключения к БД и приложения настраиваются через переменные окружения (в docker-compose.yml):

DB_HOST — адрес базы данных

DB_PORT — порт базы

DB_NAME — имя базы данных

DB_USER — пользователь

DB_PASSWORD — пароль
